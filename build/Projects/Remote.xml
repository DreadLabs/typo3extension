<?xml version="1.0" encoding="UTF-8"?>
<project name="Remote">

	<target name="remote:upload-release" depends="project:compress">
		<echo>Uploading files in progress, please be patient...</echo>

		<resolvepath
			propertyName="release.package"
			file="${build.cache.dir}${release.id}.tar.gz" />

		<if>
			<isset property="isCurrentSSH2" />
			<then>
				<scp
					host="${target.hostname}"
					port="${target.port}"
					username="${target.username}"
					password="${target.password}"
					todir="${target.path}/${target.releases.dir}/${release.id}/"
					file="${release.package}" />
			</then>
			<else>
				<exec
					command="scp -i ${target.key.public} -P ${target.port} ${release.package} ${target.username}@${target.hostname}:${target.path}/${target.releases.dir}/${release.id}"
					dir="../" />
			</else>
		</if>
	</target>

	<target name="remote:extract-release" depends="remote:setup:new-release-directory, remote:upload-release">
		<ssh
			host="${target.hostname}"
			port="${target.port}"
			username="${target.username}"
			password="${target.password}"
			command="cd ${target.path}/${target.releases.dir}/${release.id} &amp;&amp; tar xzf ${release.id}.tar.gz &amp;&amp; rm -f ${release.id}.tar.gz" />
	</target>

	<target name="remote:run" depends="project:is-clean, remote:extract-release">
		<echo>Switching `current` symlink ${target.current.dir} to release ${release.id}</echo>

		<ssh
			host="${target.hostname}"
			port="${target.port}"
			username="${target.username}"
			password="${target.password}"
			command="ln -snf ${target.path}/${target.releases.dir}/${release.id} ${target.path}/${target.current.dir}" />
	</target>
</project>